<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.0  (Linux)">
	<META NAME="CREATED" CONTENT="20061011;23522100">
	<META NAME="CHANGED" CONTENT="20061023;1322200">
	<STYLE>
	<!--
		@page { size: 21cm 29.7cm; margin: 2cm }
		P { margin-bottom: 0.21cm }
		H1.heading-2-western { font-family: "Times New Roman", serif; font-size: 18pt }
		H1.heading-2-cjk { font-family: "Bitstream Vera Sans"; font-size: 18pt }
		H1.heading-2-ctl { font-family: "Andale Sans UI"; font-size: 18pt }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-IE" DIR="LTR">
<H1 ALIGN=CENTER>Gnome Subtitles Architecture</H1>
<P ALIGN=LEFT>Contents:</P>
<UL>
	<LI><P ALIGN=LEFT><A HREF="#TheGui">The GUI</A></P>
	<LI><P ALIGN=LEFT><A HREF="#TheCore">The Core</A></P>
	<LI><P ALIGN=LEFT><A HREF="#TheDialogs">The Dialogs</A></P>
	<LI><P ALIGN=LEFT><A HREF="#Conclusion">Conclusion</A></P>
</UL>
<H1 CLASS="heading-2-western"><A NAME="TheGui"></A>The GUI</H1>
<P>Because a picture's worth a thousand words, i'll start with one.</P>
<P><IMG SRC="architecture.mainwindow.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=702 HEIGHT=541 BORDER=0>
</P>
<P>As you can see, there are 3 main areas of relevance here:</P>
<UL>
	<LI><P><B>Menus.cs</B> – Handles all menus and toolbar operations,
	like setting the sensitivity for example.</P>
	<LI><P><B>SubtitleView.cs</B> – Handles the TreeView with the list
	of subtitles. The inherent model of the TreeView is the Subtitles
	class (Subtitles.cs). 
	</P>
	<LI><P><B>SubtitleEdit.cs</B> – Contains a TextView and the timing
	SpinButtons which relate to the currently selected subtitle.</P>
</UL>
<P><BR><BR>
</P>
<H1 CLASS="heading-2-western"><A NAME="TheCore"></A>The Core</H1>
<P>The top class of the entire interface is GUI (GUI.cs). This class
contains the 3 parts of the window just described and a very
important class in the whole program - the application core:</P>
<UL>
	<LI><P><B>ApplicationCore.cs</B> – Centralizes a set of variables
	to be used throught the program. The most important are references
	to the current timing mode being used (frames or times), the
	subtitles (Subtitles.cs), the event handlers (EventHandlers.cs), the
	command manager (CommandManager.cs) that performs undo/redo
	operations, and the clipboards (Clipboards.cs). We'll get to these
	soon.</P>
</UL>
<P>One thing to keep in mind about Gnome Subtitles is that it uses
SubLib as the backend. So, any methods to handle subtitles aren't
implemented in Gnome Subtitles. In Gnome Subtitles, we handle the
interface. SubLib is changed at request to include more features. The
communication is easy because its lead developer is Gnome Subtitles'
lead developer too. The SubLib's API is available at
<A HREF="http://sublib.sf.net/api">http://sublib.sf.net/api</A>.</P>
<P>In Gnome Subtitles, the Subtitles class is used to call SubLib's
methods:</P>
<UL>
	<LI><P><B>Subtitles.cs</B> extends SubLib.Subtitles and so all
	SubLib's methods are called in Subtitles.cs. The Subtitles class is
	also the model used in the TreeView (SubtitleView.cs).</P>
</UL>
<P>Now, let's refer other important files of Gnome Subtitles, in
alphabetical order:</P>
<UL>
	<LI><P><B>Clipboards.cs</B> – handles the Primary and Secondary
	clipboards. The primary is the one used in copy/cut/paste. The
	secondary is the one used when you select text and paste it with the
	middle mouse button.</P>
	<LI><P><B>CommandManager.cs</B>: Manages commands. A command is an
	operation that changes subtitles, like adding text or changing a
	time, and is used in undo/redo. It stores the old value of the bits
	of subtitles it will change so they can be reverted on an undo. This
	file also contains the base Command classes, to be used when
	creating commands. Basically, when implementing a new feature, one
	has to write a NewFeatureCommand class that extends a base Command
	class. The available base commands are:</P>
	<UL>
		<LI><P><I>Command</I> – The most basic of them all.</P>
		<LI><P><I>MultipleSelectionCommand</I> – A command applied to
		(possibly) multiple selected subtitles. It automatically stores the
		selected subtitles when the command was ran and contains methods to
		select the subtitles and scroll to the selection. To implement a
		command like this one (e.g. The time shift command), you only have
		to override the ChangeValues method to shift the timings of the
		subtitles, the rest is already done for you.</P>
		<LI><P><I>SingleSelectionCommand</I> – A command applied to a
		single subtitle. As the previous, it automatically handles subtitle
		selection and scrolling. You only have to override the ChangeValues
		method to do the actual job of changing the subtitle.</P>
	</UL>
	<P>The existing commands are valuable examples on how to create
	commands.</P>
	<LI><P><B>EventHandlers.cs</B> – Where the event handlers are
	defined. This includes handlers for the Menus, Toolbar, SubtitleView
	and SubtitleEdit. It includes all the handlers defined in the main
	window's glade file.</P>
	<LI><P><B>Utility.cs</B> - Some basic and common utility methods</P>
	<LI><P><B>WidgetNames.cs</B> – Where the names of the widgets are
	stored.</P>
</UL>
<P>Gnome Subtitles uses Glade to design its main window and dialogs.
As such, all main interface classes (GUI, SubtitleView, SubtitleEdit,
Menus) inherit the GladeWidget class:</P>
<UL>
	<LI><P><B>GladeWidget.cs</B> – contains methods to get a widget
	and reference the main GUI.</P>
</UL>
<P>As is easily noticeable, almost all the classes have a reference
to the main GUI, so you can access any part of the interface from
another part of the interface.</P>
<P><BR><BR>
</P>
<H1 CLASS="heading-2-western"><A NAME="TheDialogs"></A>The Dialogs</H1>
<P>Finally, the dialogs. All the dialogs inherit the GladeDialog
class:</P>
<UL>
	<LI><P><B>GladeDialog.cs</B> – When creating a dialog, just by
	passing it the name of the dialog, it automatically creates de
	dialog, sets it as transient for the main window, and assigns sets
	the Gnome Subtitles icon in it. Also contains some other basic
	methods.</P>
</UL>
<P>Again, the existing Dialogs are good examples for creating new
ones. Basically, to implement a new dialog, just create it in glade
(inserting it in the used gnome-subtitles.glade file) and create a
class that inherits GladeDialog.</P>
<P><BR><BR>
</P>
<H1 CLASS="heading-2-western"><A NAME="Conclusion"></A>Conclusion</H1>
<P>This is all you have to know to start hacking on Gnome Subtitles.
For more information, use the <A HREF="http://lists.sourceforge.net/lists/listinfo/gsubtitles-general">Mailing
List</A> or contact the <A HREF="http://gsubtitles.sourceforge.net/credits">Authors</A>.</P>
<P>Gnome Subtitles is a work in progress. The <A HREF="http://svn.sourceforge.net/viewvc/*checkout*/gsubtitles/trunk/gnome-subtitles/TODO">TODO</A>
list in the <A HREF="http://gsubtitles.sourceforge.net/development">development</A>
section of the website contains the planed features to be implemented
next.</P>
<P><BR><BR>
</P>
</BODY>
</HTML>